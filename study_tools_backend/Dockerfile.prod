# Production Dockerfile for Study Tools Backend
# Builds TypeScript and runs with Node (no hot-reload)

FROM node:22-alpine

# Install build dependencies for native modules (better-sqlite3)
RUN apk add --no-cache python3 make g++ sqlite-dev

WORKDIR /app

# Install dependencies
COPY package*.json ./
RUN npm ci --build-from-source

# Copy source and build
COPY . .
RUN npm run build

EXPOSE 3001

# Run production server (no nodemon/hot-reload)
CMD ["npm", "start"]
