# Production Docker Compose configuration
# No hot-reload - containers won't restart when source files change
#
# Usage:
#   docker compose up -d              # Start with default API URL
#   docker compose up -d --build      # Rebuild and start
#
# To use a custom API URL, set VITE_API_BASE_URL in your environment:
#   VITE_API_BASE_URL=http://myserver:3001/api docker compose up -d
#
# For development with hot-reload, use:
#   docker compose -f compose.dev.yaml up

services:
  backend:
    build:
      context: ./study_tools_backend
      dockerfile: Dockerfile.prod
    ports:
      - "3001:3001"
    volumes:
      # Data volume only - no source mounts for production
      - ${DATA_DIR:-./study_tools_backend/data}:/data
    environment:
      - NODE_ENV=production
      - DATA_DIR=/data
      - PORT=3001

  frontend:
    build:
      context: ./study_tools
      dockerfile: Dockerfile.prod
    ports:
      - "80:80"
    environment:
      # API URL can be overridden at runtime
      # Default points to backend container via localhost (for same-host deployment)
      - VITE_API_BASE_URL=${VITE_API_BASE_URL:-http://localhost:3001/api}
    depends_on:
      - backend
